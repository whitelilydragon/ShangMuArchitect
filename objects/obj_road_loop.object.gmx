<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>spr_road_loop</spriteName>
  <solid>0</solid>
  <visible>0</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>obj_loop_logic</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//Check for Tiles on Layer 2.
tile_surface_id = tile_layer_find(surface_slopes,x,y)
obj = obj_game_logic
edit = obj_level_editor
alpha = 0.1
alpha_lerp = 1
tile_slope_surface_id_0 = -1
tile_slope_surface_id_1 = -1
tile_slope_surface_id_2 = -1
slope_surface_tile_1_id = -1
slope_surface_tile_2_id = -1
slope_surface_tile_3_id = -1
slope_surface_tile_4_id = -1
enemy_shifting_tile_left = -1
enemy_shifting_tile_right = -1
tile_flat_surface_id = -1
tile_flat_surface_id_1 = -1
tile_flat_surface_id_2 = -1
tile_flat_surface_id_3 = -1
tile_flat_surface_id_4 = -1
house_keeping = 0
tile_flat_surface_id = -1
tile_flat_surface_id_1 = -1
use_logic_controller_timer = 0
tile_extra_flat_surfaces = 0
integrity_timer = 0
//Are We Allowed To Hold Items?
give_item = 0
item = 0

//If we have found a slope tile, setup our startup variables
if tile_surface_id!=-1
    {
        x = tile_get_x(tile_surface_id)
        y = tile_get_y(tile_surface_id)

        house_keeping = 1

        //Get Tile ID
        tile_surface_id_asset = tile_get_background(tile_surface_id)

        //Top-Left
        if tile_surface_id_asset = wd_slope_16
        or tile_surface_id_asset = wd_slope_20
            {
                tile_slope_surface_id_0 = tile_layer_find(surface_slopes,x+148,y);     //Top-Right
                tile_slope_surface_id_1 = tile_layer_find(surface_slopes,x,y+148);     //Bottom-Left
                tile_slope_surface_id_2 = tile_layer_find(surface_slopes,x+148,y+148); //Bottom-Right

                slope_surface_tile_1_id = tile_surface_id           //Top-Left
                slope_surface_tile_2_id = tile_slope_surface_id_1   //Bottom-Left
                slope_surface_tile_3_id = tile_slope_surface_id_0   //Top-Right
                slope_surface_tile_4_id = tile_slope_surface_id_2   //Bottom-Right

                //Top-Right
                if tile_slope_surface_id_0 != -1
                    {
                        var tile_slope_surface_id_asset_0 = tile_get_background(tile_slope_surface_id_0);
                        if tile_slope_surface_id_asset_0 = wd_slope_18
                        or tile_slope_surface_id_asset_0 = wd_slope_22
                            house_keeping = 2;
                        else
                            {
                                scr_set_message("Wrong slope tile used for top-right piece" + " (Loop)")
                                instance_destroy(); 
                            }
                    }
                //Bottom-Left
                if tile_slope_surface_id_1 != -1
                    {
                        var tile_slope_surface_id_asset_1 = tile_get_background(tile_slope_surface_id_1);
                        if tile_slope_surface_id_asset_1 = wd_slope_17
                        or tile_slope_surface_id_asset_1 = wd_slope_21
                            house_keeping = 2;
                        else
                            {
                                scr_set_message("Wrong slope tile used for bottom-left piece" + " (Loop)")
                                instance_destroy(); 
                            }
                    }
                //Bottom-Right
                if tile_slope_surface_id_2 != -1
                    {
                        var tile_slope_surface_id_asset_2 = tile_get_background(tile_slope_surface_id_2);
                        if tile_slope_surface_id_asset_2 = wd_slope_19
                        or tile_slope_surface_id_asset_2 = wd_slope_23
                            house_keeping = 2;
                        else
                            {
                                scr_set_message("Wrong slope tile used for bottom-right piece" + " (Loop)")
                                instance_destroy(); 
                            }
                    }
                if tile_slope_surface_id_0 = -1
                or tile_slope_surface_id_1 = -1
                or tile_slope_surface_id_2 = -1
                    {
                        //If no such tile has been found, report the error to the console and self-destruct
                        scr_set_message("Loop structure is incomplete" + " (Loop)")
                        instance_destroy(); 
                    }
                //If nothing went wrong during the detection process, begin further execution
                else house_keeping = 2;
            }
        //Bottom-Left
        if tile_surface_id_asset = wd_slope_17
        or tile_surface_id_asset = wd_slope_21
            {
                tile_slope_surface_id_0 = tile_layer_find(surface_slopes,x+148,y+8);//Bottom-Right
                tile_slope_surface_id_1 = tile_layer_find(surface_slopes,x+8,y-8);  //Top-Left
                tile_slope_surface_id_2 = tile_layer_find(surface_slopes,x+148,y-8);//Top-Right

                slope_surface_tile_1_id = tile_slope_surface_id_1   //Top-Left
                slope_surface_tile_2_id = tile_surface_id           //Bottom-Left
                slope_surface_tile_3_id = tile_slope_surface_id_2   //Top-Right
                slope_surface_tile_4_id = tile_slope_surface_id_0   //Bottom-Right

                //Bottom-Right
                if tile_slope_surface_id_0 != -1
                    {
                        var tile_slope_surface_id_asset_0 = tile_get_background(tile_slope_surface_id_0);
                        if tile_slope_surface_id_asset_0 = wd_slope_19
                        or tile_slope_surface_id_asset_0 = wd_slope_23
                            house_keeping = 2;
                        else
                            {
                                scr_set_message("Wrong slope tile used for bottom-right piece" + " (Loop)")
                                instance_destroy(); 
                            }
                    }
                //Top-Left
                if tile_slope_surface_id_1 != -1
                    {
                        x = tile_get_x(tile_slope_surface_id_1)
                        y = tile_get_y(tile_slope_surface_id_1)
                        var tile_slope_surface_id_asset_1 = tile_get_background(tile_slope_surface_id_1);
                        if tile_slope_surface_id_asset_1 = wd_slope_16
                        or tile_slope_surface_id_asset_1 = wd_slope_20
                            house_keeping = 2;
                        else
                            {
                                scr_set_message("Wrong slope tile used for top-left piece" + " (Loop)")
                                instance_destroy(); 
                            }
                    }
                //Top-Right
                if tile_slope_surface_id_2 != -1
                    {
                        var tile_slope_surface_id_asset_2 = tile_get_background(tile_slope_surface_id_2);
                        if tile_slope_surface_id_asset_2 = wd_slope_18
                        or tile_slope_surface_id_asset_2 = wd_slope_22
                            house_keeping = 2;
                        else
                            {
                                scr_set_message("Wrong slope tile used for top-right piece" + " (Loop)")
                                instance_destroy(); 
                            }
                    }
                if tile_slope_surface_id_0 = -1
                or tile_slope_surface_id_1 = -1
                or tile_slope_surface_id_2 = -1
                    {
                        //If no such tile has been found, report the error to the console and self-destruct
                        scr_set_message("Loop structure is incomplete" + " (Loop)")
                        instance_destroy(); 
                    }
                //If nothing went wrong during the detection process, begin further execution
                else house_keeping = 2;
            }
        //Top-Right
        if tile_surface_id_asset = wd_slope_18
        or tile_surface_id_asset = wd_slope_22
            {
                tile_slope_surface_id_0 = tile_layer_find(surface_slopes,x-8,y+8);//Top-Left
                tile_slope_surface_id_1 = tile_layer_find(surface_slopes,x+8,y+148);//Bottom-Right
                tile_slope_surface_id_2 = tile_layer_find(surface_slopes,x-8,y+148);//Bottom-Left

                slope_surface_tile_1_id = tile_slope_surface_id_0   //Top-Left
                slope_surface_tile_2_id = tile_slope_surface_id_2   //Bottom-Left
                slope_surface_tile_3_id = tile_surface_id           //Top-Right
                slope_surface_tile_4_id = tile_slope_surface_id_1   //Bottom-Right

                //Top-Left
                if tile_slope_surface_id_0 != -1
                    {
                        x = tile_get_x(tile_slope_surface_id_0)
                        y = tile_get_y(tile_slope_surface_id_0)
                        var tile_slope_surface_id_asset_0 = tile_get_background(tile_slope_surface_id_0);
                        if tile_slope_surface_id_asset_0 = wd_slope_16
                        or tile_slope_surface_id_asset_0 = wd_slope_20
                            house_keeping = 2;
                        else
                            {
                                scr_set_message("Wrong slope tile used for bottom-right piece" + " (Loop)")
                                instance_destroy(); 
                            }
                    }
                //Bottom-Right
                if tile_slope_surface_id_1 != -1
                    {
                        var tile_slope_surface_id_asset_1 = tile_get_background(tile_slope_surface_id_1);
                        if tile_slope_surface_id_asset_1 = wd_slope_19
                        or tile_slope_surface_id_asset_1 = wd_slope_23
                            house_keeping = 2;
                        else
                            {
                                scr_set_message("Wrong slope tile used for top-left piece" + " (Loop)")
                                instance_destroy(); 
                            }
                    }
                //Bottom-Left
                if tile_slope_surface_id_2 != -1
                    {
                        var tile_slope_surface_id_asset_2 = tile_get_background(tile_slope_surface_id_2);
                        if tile_slope_surface_id_asset_2 = wd_slope_17
                        or tile_slope_surface_id_asset_2 = wd_slope_21
                            house_keeping = 2;
                        else
                            {
                                scr_set_message("Wrong slope tile used for top-right piece" + " (Loop)")
                                instance_destroy(); 
                            }
                    }
                if tile_slope_surface_id_0 = -1
                or tile_slope_surface_id_1 = -1
                or tile_slope_surface_id_2 = -1
                    {
                        //If no such tile has been found, report the error to the console and self-destruct
                        scr_set_message("Loop structure is incomplete" + " (Loop)")
                        instance_destroy(); 
                    }
                //If nothing went wrong during the detection process, begin further execution
                else house_keeping = 2;
            }
        //Bottom-Right
        if tile_surface_id_asset = wd_slope_19
        or tile_surface_id_asset = wd_slope_23
            {
                tile_slope_surface_id_0 = tile_layer_find(surface_slopes,x-8,y-8);//Top-Left
                tile_slope_surface_id_1 = tile_layer_find(surface_slopes,x+8,y-8);//Top-Right
                tile_slope_surface_id_2 = tile_layer_find(surface_slopes,x-8,y+8);//Bottom-Left

                slope_surface_tile_1_id = tile_slope_surface_id_0   //Top-Left
                slope_surface_tile_2_id = tile_slope_surface_id_2   //Bottom-Left
                slope_surface_tile_3_id = tile_slope_surface_id_1   //Top-Right
                slope_surface_tile_4_id = tile_surface_id           //Bottom-Right

                //Top-Left
                if tile_slope_surface_id_0 != -1
                    {
                        x = tile_get_x(tile_slope_surface_id_0)
                        y = tile_get_y(tile_slope_surface_id_0)
                        var tile_slope_surface_id_asset_0 = tile_get_background(tile_slope_surface_id_0);
                        if tile_slope_surface_id_asset_0 = wd_slope_16
                        or tile_slope_surface_id_asset_0 = wd_slope_20
                            house_keeping = 2;
                        else
                            {
                                scr_set_message("Wrong slope tile used for top-left piece" + " (Loop)")
                                instance_destroy(); 
                            }
                    }
                //Top-Right
                if tile_slope_surface_id_1 != -1
                    {
                        var tile_slope_surface_id_asset_1 = tile_get_background(tile_slope_surface_id_1);
                        if tile_slope_surface_id_asset_1 = wd_slope_18
                        or tile_slope_surface_id_asset_1 = wd_slope_22
                            house_keeping = 2;
                        else
                            {
                                scr_set_message("Wrong slope tile used for top-right piece" + " (Loop)")
                                instance_destroy(); 
                            }
                    }
                //Bottom-Left
                if tile_slope_surface_id_2 != -1
                    {
                        var tile_slope_surface_id_asset_2 = tile_get_background(tile_slope_surface_id_2);
                        if tile_slope_surface_id_asset_2 = wd_slope_17
                        or tile_slope_surface_id_asset_2 = wd_slope_21
                            house_keeping = 2;
                        else
                            {
                                scr_set_message("Wrong slope tile used for bottom-left piece" + " (Loop)")
                                instance_destroy(); 
                            }
                    }
                if tile_slope_surface_id_0 = -1
                or tile_slope_surface_id_1 = -1
                or tile_slope_surface_id_2 = -1
                    {
                        //If no such tile has been found, report the error to the console and self-destruct
                        scr_set_message("Loop structure is incomplete" + " (Loop)")
                        instance_destroy(); 
                    }
                //If nothing went wrong during the detection process, begin further execution
                else house_keeping = 2;
            }

        //If no such tile has been found, report the error to the console and self-destruct
        if not (tile_surface_id_asset = wd_slope_16
        or tile_surface_id_asset = wd_slope_18
        or tile_surface_id_asset = wd_slope_19
        or tile_surface_id_asset = wd_slope_17
        or tile_surface_id_asset = wd_slope_20
        or tile_surface_id_asset = wd_slope_22
        or tile_surface_id_asset = wd_slope_23
        or tile_surface_id_asset = wd_slope_21)
            {
                scr_set_message("Wrong slope tiles were used at "+string(x)+"; "+string(y))
                instance_destroy(); 
            }
        var ID_check = instance_place(x,y,obj_loop_logic);
        if ID_check != -1
            {
                if ID_check != instance_id and ID_check.use_logic_controller_timer &gt;= 8
                    {
                        scr_set_message("Cannot place loop controllers over others")
                        instance_destroy(); 
                    }
            }
        var ID_check = instance_place(x,y,obj_2D_tile_logic);
        if instance_exists(ID_check)
            {
                ID_check.delete_self = 1
                ID_check.dont_delete_tile = 1
                //Top-right loop piece
                var ID_check = instance_place(x+84,y+4,obj_2D_tile_logic);
                if instance_exists(ID_check)
                    {
                        ID_check.delete_self = 1
                        ID_check.dont_delete_tile = 1
                    }
                //Bottom-left loop piece
                var ID_check = instance_place(x+4,y+132,obj_2D_tile_logic);
                if instance_exists(ID_check)
                    {
                        ID_check.delete_self = 1
                        ID_check.dont_delete_tile = 1
                    }
                //Bottom-right loop piece
                var ID_check = instance_place(x+84,y+132,obj_2D_tile_logic);
                if instance_exists(ID_check)
                    {
                        ID_check.delete_self = 1
                        ID_check.dont_delete_tile = 1
                    }
            }
        //Add Flat Surface Tile (To prevent the player from falling off of the loop)
        tile_flat_surface_id = tile_add(mu_door_2,0,0,128,16,x+16,y+244,surface_flats)
        
        tile_flat_surface_id_1 = tile_add(mu_door_2,0,0,128,16,x+16,y+16,0)
        tile_set_visible(tile_flat_surface_id_1,false)
        
        tile_set_visible(tile_flat_surface_id,false)
    }
//If no such tile has been found, create our own loop tiles
else
    {
        if x &lt; 140 or x &gt; room_width-140
            {
                scr_set_message("Cannot place loop controller at canvas edges")
                instance_destroy();
            }
        else
            {
                slope_surface_tile_1_id = tile_add(wd_slope_16,0,0,152,144,edit.user_grid_snap_x-152,edit.user_grid_snap_y-268,surface_slopes)
                slope_surface_tile_2_id = tile_add(wd_slope_17,0,0,152,144,edit.user_grid_snap_x-152,edit.user_grid_snap_y-124,surface_slopes)
                slope_surface_tile_3_id = tile_add(wd_slope_18,0,0,152,144,edit.user_grid_snap_x,edit.user_grid_snap_y-268,surface_slopes)
                slope_surface_tile_4_id = tile_add(wd_slope_19,0,0,152,144,edit.user_grid_snap_x,edit.user_grid_snap_y-124,surface_slopes)
        
                x = tile_get_x(slope_surface_tile_1_id)
                y = tile_get_y(slope_surface_tile_1_id)
        
                tile_surface_id = slope_surface_tile_1_id

                //Add Flat Surface Tile (To prevent the player from falling off of the loop)
                tile_flat_surface_id = tile_add(mu_door_2,0,0,296,20,x+8,y+15,surface_flats)

                tile_flat_surface_id_2 = tile_add(mu_door_2,0,0,272,40,x+16,y+232,surface_flats)
                tile_flat_surface_id_3 = tile_add(mu_door_2,0,0,44,128,x+8,y+16,0)
                tile_flat_surface_id_4 = tile_add(mu_door_2,0,0,44,128,x+252,y+16,0)
                tile_set_visible(tile_flat_surface_id_2,false)
                tile_set_visible(tile_flat_surface_id_3,false)
                tile_set_visible(tile_flat_surface_id_4,false)
                
                tile_set_visible(tile_flat_surface_id,false)
            }
    }

//Collision Region 1 (Enter from left)
collision_region_1_x_1 = x-25
collision_region_1_y_1 = y+154
collision_region_1_x_2 = x+16
collision_region_1_y_2 = y+233

//Collision Region 2 (Enter from right)
collision_region_2_x_1 = x+288
collision_region_2_y_1 = y+154
collision_region_2_x_2 = x+328
collision_region_2_y_2 = y+233

//Collision Region 3 (Top-left tile-switcher)
collision_region_3_x_1 = x+78
collision_region_3_y_1 = y+54
collision_region_3_x_2 = x+119
collision_region_3_y_2 = y+134

//Collision Region 4 (Top-right tile-switcher)
collision_region_4_x_1 = x+184
collision_region_4_y_1 = y+54
collision_region_4_x_2 = x+225
collision_region_4_y_2 = y+134

//Make Ourselves Visible If We Are In Editor Mode
if room = rm_editor
    {
        if (obj_level_editor.use_debug_hud_mode = 1 and visible = false) visible = true;
        if (obj_level_editor.use_debug_hud_mode = 0 and visible = true) visible = false;
    }
else
    {
        if (obj_game_logic.debug_hud != 1 and visible = false) visible = true;
        if (obj_game_logic.debug_hud = 1  and visible = true) visible = false;
    }
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
